%union {
  long l;
  char *s;
  double f;
}

%token <s> STRING
%token NODE
%token LAT
%token LON
%token <l> INTEGER
%token <f> FLOAT
%token COUNTRYCODE
%token COUNTRY
%token CITY
%token STREET
%token NUMBER
%token POSTCODE
%token LATLON

%type<l> num
%type<f> coor

%{

using namespace std;

#include <string>
#include <stdexcept>
#include "routeinfo.h"

int yylex(void);
void yyerror (char *s) {
     throw runtime_error(s);
}

void yyerror (string s) {
     throw runtime_error(s);
}

int locptr;

%}

%%

route		: vehicle '(' start ',' stop ')'
		;

vehicle		: STRING {inforoute.vehicle = $1;}
		;

start		: {locptr=0;} locatie
		;

stop		: {locptr=1;} locatie
		;

locatie		: NODE '=' num {inforoute.locations[locptr].node=true;inforoute.locations[locptr].nodeid=$3;}
		| num {inforoute.locations[locptr].node=true;inforoute.locations[locptr].nodeid=$1;}
		| LAT '=' coor ',' LON '=' coor {inforoute.locations[locptr].coord=true;inforoute.locations[locptr].lat=$3;inforoute.locations[locptr].lon=$7;}
		| LON '=' coor ',' LAT '=' coor {inforoute.locations[locptr].coord=true;inforoute.locations[locptr].lat=$7;inforoute.locations[locptr].lon=$3;}
		| LATLON '=' '(' coor ',' coor ')' {inforoute.locations[locptr].coord=true;inforoute.locations[locptr].lat=$4;inforoute.locations[locptr].lon=$6;}
		| '(' coor ',' coor ')' {inforoute.locations[locptr].coord=true;inforoute.locations[locptr].lat=$2;inforoute.locations[locptr].lon=$4;}
		| adres
		;

num		: INTEGER {$$=$1;}
		;

coor		: INTEGER
		| FLOAT
		;

adres		: country  city
		| country  city  street
		| country  city  street  number
		;

country		: COUNTRY '=' COUNTRYCODE
		|
		;

city		: CITY '=' STRING
		;

street		: STREET '=' STRING
		;
	
number		: NUMBER '=' STRING
		;
%%
